"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[155],{7348:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"core-features/architecture-queries","title":"Architecture & Queries","description":"This plugin is powered by bean-query, the Beancount Query Language (BQL) engine. Every piece of data you see in the dashboard comes from direct BQL queries against your Beancount files.","source":"@site/docs/core-features/architecture-queries.md","sourceDirName":"core-features","slug":"/core-features/architecture-queries","permalink":"/obsidian-finance-plugin/docs/core-features/architecture-queries","draft":false,"unlisted":false,"editUrl":"https://github.com/mkshp-dev/obsidian-finance-plugin/tree/dev/docs-site/docs/core-features/architecture-queries.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Snapshot View","permalink":"/obsidian-finance-plugin/docs/core-features/snapshot-view"},"next":{"title":"Overview Tab","permalink":"/obsidian-finance-plugin/docs/core-features/unified-dashboard/overview"}}');var r=s(4848),t=s(8453);const a={sidebar_position:6},l="Architecture & Queries",c={},o=[{value:"\ud83c\udfd7\ufe0f Architecture Overview",id:"\ufe0f-architecture-overview",level:2},{value:"\ud83d\udcca Overview Tab Queries",id:"-overview-tab-queries",level:2},{value:"Net Worth Components",id:"net-worth-components",level:3},{value:"Monthly Income &amp; Expenses",id:"monthly-income--expenses",level:3},{value:"Historical Net Worth Chart",id:"historical-net-worth-chart",level:3},{value:"\ud83d\udcb0 Transactions Tab Queries",id:"-transactions-tab-queries",level:2},{value:"Transaction List with Filters",id:"transaction-list-with-filters",level:3},{value:"\ud83d\udccb Journal Tab Queries",id:"-journal-tab-queries",level:2},{value:"Transaction Entries",id:"transaction-entries",level:3},{value:"Balance Assertions",id:"balance-assertions",level:3},{value:"Note Entries",id:"note-entries",level:3},{value:"\ud83c\udfe6 Balance Sheet Tab Queries",id:"-balance-sheet-tab-queries",level:2},{value:"Market Value (Default)",id:"market-value-default",level:3},{value:"Historical Cost",id:"historical-cost",level:3},{value:"Units (Raw Holdings)",id:"units-raw-holdings",level:3},{value:"\ud83e\ude99 Commodities Tab Queries",id:"-commodities-tab-queries",level:2},{value:"List All Commodities",id:"list-all-commodities",level:3},{value:"Commodity Price Data",id:"commodity-price-data",level:3},{value:"Commodity Details",id:"commodity-details",level:3},{value:"\ud83d\udd0d Helper Queries",id:"-helper-queries",level:2},{value:"Get All Open Accounts",id:"get-all-open-accounts",level:3},{value:"Get All Unique Tags",id:"get-all-unique-tags",level:3},{value:"File Validation",id:"file-validation",level:3},{value:"\ud83d\udee0\ufe0f Using These Queries",id:"\ufe0f-using-these-queries",level:2},{value:"In Terminal",id:"in-terminal",level:3},{value:"In Your Notes",id:"in-your-notes",level:3},{value:"Inline in Text",id:"inline-in-text",level:3},{value:"\ud83d\udcdd Query Syntax Notes",id:"-query-syntax-notes",level:2},{value:"\ud83d\udd17 Learn More",id:"-learn-more",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"architecture--queries",children:"Architecture & Queries"})}),"\n",(0,r.jsxs)(n.p,{children:["This plugin is powered by ",(0,r.jsx)(n.strong,{children:"bean-query"}),", the Beancount Query Language (BQL) engine. Every piece of data you see in the dashboard comes from direct BQL queries against your Beancount files."]}),"\n",(0,r.jsx)(n.p,{children:"This page documents the exact queries used throughout the plugin, so you can understand, modify, or replicate them in your own workflows."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-architecture-overview",children:"\ud83c\udfd7\ufe0f Architecture Overview"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Plugin reads your ",(0,r.jsx)(n.code,{children:".beancount"})," files"]}),"\n",(0,r.jsxs)(n.li,{children:["Executes BQL queries via ",(0,r.jsx)(n.code,{children:"bean-query"})," command-line tool"]}),"\n",(0,r.jsx)(n.li,{children:"Parses CSV results"}),"\n",(0,r.jsx)(n.li,{children:"Renders data in dashboard or note views"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key principle:"})," All data retrieval happens through BQL - there's no proprietary API or database. You can run any of these queries manually in your terminal."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-overview-tab-queries",children:"\ud83d\udcca Overview Tab Queries"}),"\n",(0,r.jsx)(n.h3,{id:"net-worth-components",children:"Net Worth Components"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Total Assets:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT convert(sum(position), 'USD') WHERE account ~ '^Assets'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Total Liabilities:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT convert(sum(position), 'USD') WHERE account ~ '^Liabilities'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Note: Net Worth = Assets - |Liabilities|"})}),"\n",(0,r.jsx)(n.h3,{id:"monthly-income--expenses",children:"Monthly Income & Expenses"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Current Month Income:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT convert(sum(position), 'USD') WHERE account ~ '^Income' AND date >= 2026-02-01 AND date <= 2026-02-28\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Current Month Expenses:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT convert(sum(position), 'USD') WHERE account ~ '^Expenses' AND date >= 2026-02-01 AND date <= 2026-02-28\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Dates are dynamically calculated based on current month"})}),"\n",(0,r.jsx)(n.h3,{id:"historical-net-worth-chart",children:"Historical Net Worth Chart"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Net Worth Over Time:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT year, month, only('USD', convert(last(balance), 'USD', last(date))) WHERE account ~ '^(Assets|Liabilities)' ORDER BY year, month\n"})}),"\n",(0,r.jsx)(n.p,{children:"This query:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Groups data by year and month"}),"\n",(0,r.jsx)(n.li,{children:"Gets the last balance for each month"}),"\n",(0,r.jsx)(n.li,{children:"Converts to your operating currency"}),"\n",(0,r.jsx)(n.li,{children:"Includes both Assets and Liabilities for net worth calculation"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-transactions-tab-queries",children:"\ud83d\udcb0 Transactions Tab Queries"}),"\n",(0,r.jsx)(n.h3,{id:"transaction-list-with-filters",children:"Transaction List with Filters"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Base Query (all transactions):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With Account Filter:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance WHERE account ~ '^Assets:Checking' ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With Date Range:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance WHERE date >= 2026-01-01 AND date <= 2026-12-31 ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With Payee Filter:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance WHERE payee ~ 'Amazon' ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With Tag Filter:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance WHERE 'vacation' IN tags ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Combined Filters:"}),"\nMultiple conditions are joined with ",(0,r.jsx)(n.code,{children:"AND"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, payee, narration, position, balance WHERE account ~ '^Expenses:Food' AND date >= 2026-01-01 AND date <= 2026-01-31 ORDER BY date DESC, lineno DESC LIMIT 1000\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-journal-tab-queries",children:"\ud83d\udccb Journal Tab Queries"}),"\n",(0,r.jsx)(n.p,{children:"The Journal tab combines three types of entries:"}),"\n",(0,r.jsx)(n.h3,{id:"transaction-entries",children:"Transaction Entries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT id, date, flag, payee, narration, tags, links, filename, lineno, account, number, currency, cost_number, cost_currency, cost_date, price, entry.meta as entry_meta FROM postings WHERE <filters> ORDER BY date DESC, id, account\n"})}),"\n",(0,r.jsx)(n.p,{children:"This query:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Retrieves all postings from the ",(0,r.jsx)(n.code,{children:"postings"})," table"]}),"\n",(0,r.jsx)(n.li,{children:"Groups by transaction ID client-side"}),"\n",(0,r.jsx)(n.li,{children:"Includes metadata and file location for editing"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"balance-assertions",children:"Balance Assertions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, account, amount, tolerance, discrepancy FROM #balances WHERE <filters> ORDER BY date DESC, account\n"})}),"\n",(0,r.jsx)(n.h3,{id:"note-entries",children:"Note Entries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT date, account, comment, tags, links, meta FROM #notes WHERE <filters> ORDER BY date DESC, account\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-balance-sheet-tab-queries",children:"\ud83c\udfe6 Balance Sheet Tab Queries"}),"\n",(0,r.jsx)(n.h3,{id:"market-value-default",children:"Market Value (Default)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT account, convert(sum(position), 'USD') WHERE account ~ '^(Assets|Liabilities|Equity)' AND NOT close_date(account) GROUP BY account ORDER BY account\n"})}),"\n",(0,r.jsx)(n.p,{children:"This converts all holdings to your operating currency at current market prices."}),"\n",(0,r.jsx)(n.h3,{id:"historical-cost",children:"Historical Cost"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT account, cost(sum(position)) WHERE account ~ '^(Assets|Liabilities|Equity)' AND NOT close_date(account) GROUP BY account ORDER BY account\n"})}),"\n",(0,r.jsx)(n.p,{children:"Shows original purchase prices - useful for tax calculations."}),"\n",(0,r.jsx)(n.h3,{id:"units-raw-holdings",children:"Units (Raw Holdings)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT account, units(sum(position)) WHERE account ~ '^(Assets|Liabilities|Equity)' AND NOT close_date(account) GROUP BY account ORDER BY account\n"})}),"\n",(0,r.jsx)(n.p,{children:'Shows actual quantities held (e.g., "50 AAPL", "1.5 BTC").'}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-commodities-tab-queries",children:"\ud83e\ude99 Commodities Tab Queries"}),"\n",(0,r.jsx)(n.h3,{id:"list-all-commodities",children:"List All Commodities"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT name AS name_ FROM #commodities GROUP BY name\n"})}),"\n",(0,r.jsx)(n.h3,{id:"commodity-price-data",children:"Commodity Price Data"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT last(date) AS date_, last(currency) AS currency_, round(getprice(last(currency), 'USD'),2) AS price_, currency_meta(last(currency), 'logo') AS logo_, bool(today()-1<last(date)) AS islatest_ FROM #prices GROUP BY currency\n"})}),"\n",(0,r.jsx)(n.p,{children:"This query:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Gets the most recent price for each commodity"}),"\n",(0,r.jsx)(n.li,{children:"Converts to operating currency"}),"\n",(0,r.jsx)(n.li,{children:"Retrieves logo metadata"}),"\n",(0,r.jsx)(n.li,{children:'Flags prices updated within last day as "latest"'}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"commodity-details",children:"Commodity Details"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT name AS name_, last(meta) AS meta_, currency_meta(last(name),'logo') AS logo_, currency_meta(last(name), 'price') AS pricemetadata_, meta('filename') AS filename_, meta('lineno') AS lineno_ FROM #commodities WHERE name='AAPL'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Retrieves full metadata including:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Logo URL"}),"\n",(0,r.jsx)(n.li,{children:'Price source (e.g., "yahoo/AAPL")'}),"\n",(0,r.jsx)(n.li,{children:"File location for editing"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-helper-queries",children:"\ud83d\udd0d Helper Queries"}),"\n",(0,r.jsx)(n.h3,{id:"get-all-open-accounts",children:"Get All Open Accounts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT account\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Post-processed to get unique list of open accounts"})}),"\n",(0,r.jsx)(n.h3,{id:"get-all-unique-tags",children:"Get All Unique Tags"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT tags\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Post-processed to extract unique tags from all transactions"})}),"\n",(0,r.jsx)(n.h3,{id:"file-validation",children:"File Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT TRUE LIMIT 0\n"})}),"\n",(0,r.jsx)(n.p,{children:"This validates Beancount file syntax without returning data - used by the connection test."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-using-these-queries",children:"\ud83d\udee0\ufe0f Using These Queries"}),"\n",(0,r.jsx)(n.h3,{id:"in-terminal",children:"In Terminal"}),"\n",(0,r.jsx)(n.p,{children:"Run any query manually:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bean-query /path/to/your.beancount \"SELECT account, sum(position) WHERE account ~ '^Assets' GROUP BY account\"\n"})}),"\n",(0,r.jsx)(n.h3,{id:"in-your-notes",children:"In Your Notes"}),"\n",(0,r.jsx)(n.p,{children:"Use BQL code blocks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bql",children:"SELECT account, sum(position) WHERE account ~ '^Assets' GROUP BY account\n"})}),"\n",(0,r.jsx)(n.h3,{id:"inline-in-text",children:"Inline in Text"}),"\n",(0,r.jsx)(n.p,{children:"Embed live values:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"My current net worth: `bql:SELECT convert(sum(position), 'USD') WHERE account ~ '^(Assets|Liabilities)'`\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-query-syntax-notes",children:"\ud83d\udcdd Query Syntax Notes"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," All queries must be written on a single line in code blocks. Multi-line queries will only execute the first line."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Currency Placeholders:"})," In the queries above, ",(0,r.jsx)(n.code,{children:"'USD'"})," is used as an example. The plugin substitutes your configured operating currency from settings."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Date Formats:"})," Dates in BQL use ",(0,r.jsx)(n.code,{children:"YYYY-MM-DD"})," format without quotes (e.g., ",(0,r.jsx)(n.code,{children:"date >= 2026-01-01"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Regular Expressions:"})," The ",(0,r.jsx)(n.code,{children:"~"})," operator performs regex matching:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"account ~ '^Assets'"}),' - matches accounts starting with "Assets"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"payee ~ 'Amazon'"}),' - matches payees containing "Amazon"']}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-learn-more",children:"\ud83d\udd17 Learn More"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Official BQL Documentation:"})," ",(0,r.jsx)(n.a,{href:"https://beancount.github.io/docs/beancount_query_language.html",children:"Beancount Query Language"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query Examples:"})," See our ",(0,r.jsx)(n.a,{href:"/obsidian-finance-plugin/docs/queries/bql",children:"BQL Queries"})," page for more examples"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source Code:"})," All query definitions are in ",(0,r.jsx)(n.a,{href:"https://github.com/mkshp-dev/obsidian-finance-plugin/blob/master/src/queries/index.ts",children:(0,r.jsx)(n.code,{children:"src/queries/index.ts"})})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);