"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[594],{6333:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"agent-context","title":"Agent Context","description":"This document provides technical context for AI agents and developers working on the obsidian-finance-plugin. It outlines the architecture, key file structures, and development patterns.","source":"@site/docs/agent-context.md","sourceDirName":".","slug":"/agent-context","permalink":"/obsidian-finance-plugin/docs/agent-context","draft":false,"unlisted":false,"editUrl":"https://github.com/mkshp-dev/obsidian-finance-plugin/tree/agent/docs-site/docs/agent-context.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"First-Time Setup","permalink":"/obsidian-finance-plugin/docs/getting-started/first-time-setup"},"next":{"title":"Adding Directives","permalink":"/obsidian-finance-plugin/docs/core-features/adding-directives"}}');var r=s(4848),t=s(8453);const c={sidebar_position:11},l="Agent Context",d={},o=[{value:"\ud83c\udfd7\ufe0f Architecture",id:"\ufe0f-architecture",level:2},{value:"\ud83d\udcc2 Key Directories",id:"-key-directories",level:2},{value:"\ud83e\udde9 Key Patterns",id:"-key-patterns",level:2},{value:"Direct CLI Execution",id:"direct-cli-execution",level:3},{value:"Safe File Writes",id:"safe-file-writes",level:3},{value:"BQL Execution",id:"bql-execution",level:3},{value:"CRUD Operations",id:"crud-operations",level:3},{value:"System DEnable debug mode in settings, check Obsidian&#39;s Developer Console (Ctrl+Shift+I).",id:"system-denable-debug-mode-in-settings-check-obsidians-developer-console-ctrlshifti",level:3},{value:"\ud83e\udd16 Common Tasks for Agents",id:"-common-tasks-for-agents",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"agent-context",children:"Agent Context"})}),"\n",(0,r.jsxs)(n.p,{children:["This document provides technical context for AI agents and developers working on the ",(0,r.jsx)(n.code,{children:"obsidian-finance-plugin"}),". It outlines the architecture, key file structures, and development patterns."]}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-architecture",children:"\ud83c\udfd7\ufe0f Architecture"}),"\n",(0,r.jsxs)(n.p,{children:["The plugin uses a ",(0,r.jsx)(n.strong,{children:"pure TypeScript/Svelte architecture"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Frontend (TypeScript/Svelte)"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Runs within Obsidian (Electron)."}),"\n",(0,r.jsx)(n.li,{children:"Manages UI, Settings, and all File I/O operations."}),"\n",(0,r.jsxs)(n.li,{children:["Uses Svelte for views (",(0,r.jsx)(n.code,{children:"src/ui/views/"}),", ",(0,r.jsx)(n.code,{children:"src/ui/partials/"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Organized by modules: ",(0,r.jsx)(n.code,{children:"src/models"}),", ",(0,r.jsx)(n.code,{children:"src/services"}),", ",(0,r.jsx)(n.code,{children:"src/stores"}),", ",(0,r.jsx)(n.code,{children:"src/controllers"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Beancount Integration"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Direct CLI execution of ",(0,r.jsx)(n.code,{children:"bean-query"}),", ",(0,r.jsx)(n.code,{children:"bean-check"}),", ",(0,r.jsx)(n.code,{children:"bean-price"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"All data queries use BQL (Beancount Query Language)."}),"\n",(0,r.jsx)(n.li,{children:"No intermediate server or API layer."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File Operations"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Direct file reads/writes with atomic operations."}),"\n",(0,r.jsx)(n.li,{children:"Backup support before modifications."}),"\n",(0,r.jsx)(n.li,{children:"Line-based parsing to preserve formatting."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-key-directories",children:"\ud83d\udcc2 Key Directories"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"src/"})}),": TypeScript source code."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"main.ts"})}),": Plugin entry point."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"settings.ts"})}),": Settings tab definition."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"ui/"})}),": Svelte components, views, and modals."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"controllers/"})}),": Tab controllers managing state and data flow."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"services/"})}),": Business logic services (JournalService)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"stores/"})}),": Svelte stores for reactive state management."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"utils/"})}),": Utility functions including all CRUD operations."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"types/"})}),": TypeScript definitions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"docs-site/"})}),": Docusaurus documentation."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-key-patterns",children:"\ud83e\udde9 Key Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"direct-cli-execution",children:"Direct CLI Execution"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All BQL queries execute via ",(0,r.jsx)(n.code,{children:"runQuery()"})," function in ",(0,r.jsx)(n.code,{children:"src/utils/index.ts"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Spawns ",(0,r.jsx)(n.code,{children:"bean-query"})," as child process with proper shell escaping."]}),"\n",(0,r.jsxs)(n.li,{children:["Parses CSV output using ",(0,r.jsx)(n.code,{children:"csv-parse/sync"})," library."]}),"\n",(0,r.jsxs)(n.li,{children:["Handles WSL path conversion automatically via ",(0,r.jsx)(n.code,{children:"SystemDetector"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"safe-file-writes",children:"Safe File Writes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NEVER"})," overwrite user data without a backup."]}),"\n",(0,r.jsxs)(n.li,{children:["Pattern:","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Read file content."}),"\n",(0,r.jsxs)(n.li,{children:["Create backup: ",(0,r.jsx)(n.code,{children:"<file>.backup.<timestamp>"})," (if enabled)."]}),"\n",(0,r.jsx)(n.li,{children:"Perform modification in-memory."}),"\n",(0,r.jsxs)(n.li,{children:["Write to temp file: ",(0,r.jsx)(n.code,{children:"<file>.tmp"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Atomic rename temp to original."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"bql-execution",children:"BQL Execution"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Code Blocks"}),": Handled by ",(0,r.jsx)(n.code,{children:"src/ui/markdown/BQLCodeBlockProcessor.ts"})," registering a markdown code block processor."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Inline Queries"}),": Handled by ",(0,r.jsx)(n.code,{children:"src/ui/markdown/InlineBQLProcessor.ts"})," with regex parsing."]}),"\n",(0,r.jsxs)(n.li,{children:["Both use ",(0,r.jsx)(n.code,{children:"runQuery()"})," function for CLI execution."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"crud-operations",children:"CRUD Operations"}),"\n",(0,r.jsxs)(n.p,{children:["All entry creation, updates, and deletions are handled by functions in ",(0,r.jsx)(n.code,{children:"src/utils/index.ts"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createTransaction()"}),", ",(0,r.jsx)(n.code,{children:"updateTransaction()"}),", ",(0,r.jsx)(n.code,{children:"deleteTransaction()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createBalanceAssertion()"}),", ",(0,r.jsx)(n.code,{children:"updateBalance()"}),", ",(0,r.jsx)(n.code,{children:"deleteBalance()"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createNote()"}),", ",(0,r.jsx)(n.code,{children:"updateNote()"}),", ",(0,r.jsx)(n.code,{children:"deleteNote()"})]}),"\n",(0,r.jsx)(n.li,{children:"Each uses BQL queries to find line numbers, then performs atomic file operations."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"system-denable-debug-mode-in-settings-check-obsidians-developer-console-ctrlshifti",children:"System DEnable debug mode in settings, check Obsidian's Developer Console (Ctrl+Shift+I)."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Styles"}),": ",(0,r.jsx)(n.code,{children:"styles.css"})," contains global styles; Svelte components use scoped styles."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testing"}),': Use Settings \u2192 Connection \u2192 "Test All Commands" to validate setup.']}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-common-tasks-for-agents",children:"\ud83e\udd16 Common Tasks for Agents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Adding a new Visual Component"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create Svelte component in ",(0,r.jsx)(n.code,{children:"src/ui/partials/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Register in appropriate view (e.g., ",(0,r.jsx)(n.code,{children:"UnifiedDashboardView.svelte"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Fetch data via BQL queries using ",(0,r.jsx)(n.code,{children:"runQuery()"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Adding New CRUD Operations"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add function to ",(0,r.jsx)(n.code,{children:"src/utils/index.ts"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Follow atomic write pattern (read \u2192 backup \u2192 modify \u2192 temp write \u2192 rename)."}),"\n",(0,r.jsx)(n.li,{children:"Use BQL to find line numbers, scan to find boundaries."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Updating Documentation"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Edit files in ",(0,r.jsx)(n.code,{children:"docs-site/docs/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Follow the structure defined in ",(0,r.jsx)(n.code,{children:"sidebars.ts"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Update README.md for user-facing feature changes."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function c(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);