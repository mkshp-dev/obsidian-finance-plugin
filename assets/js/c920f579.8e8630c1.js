"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[3594],{6333:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"agent-context","title":"Agent Context","description":"This document provides technical context for AI agents and developers working on the obsidian-finance-plugin. It outlines the architecture, key file structures, and development patterns.","source":"@site/docs/agent-context.md","sourceDirName":".","slug":"/agent-context","permalink":"/obsidian-finance-plugin/docs/agent-context","draft":false,"unlisted":false,"editUrl":"https://github.com/mukundshelake/obsidian-finance-plugin/tree/main/docs-site/docs/agent-context.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting","permalink":"/obsidian-finance-plugin/docs/troubleshooting"}}');var c=s(4848),r=s(8453);const l={sidebar_position:11},d="Agent Context",t={},o=[{value:"\ud83c\udfd7\ufe0f Architecture",id:"\ufe0f-architecture",level:2},{value:"\ud83d\udcc2 Key Directories",id:"-key-directories",level:2},{value:"\ud83e\udde9 Key Patterns",id:"-key-patterns",level:2},{value:"Backend Management",id:"backend-management",level:3},{value:"Safe File Writes",id:"safe-file-writes",level:3},{value:"BQL Execution",id:"bql-execution",level:3},{value:"System Detection",id:"system-detection",level:3},{value:"\ud83d\udee0\ufe0f Development Tips",id:"\ufe0f-development-tips",level:2},{value:"\ud83e\udd16 Common Tasks for Agents",id:"-common-tasks-for-agents",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"agent-context",children:"Agent Context"})}),"\n",(0,c.jsxs)(n.p,{children:["This document provides technical context for AI agents and developers working on the ",(0,c.jsx)(n.code,{children:"obsidian-finance-plugin"}),". It outlines the architecture, key file structures, and development patterns."]}),"\n",(0,c.jsx)(n.h2,{id:"\ufe0f-architecture",children:"\ud83c\udfd7\ufe0f Architecture"}),"\n",(0,c.jsx)(n.p,{children:"The plugin uses a hybrid architecture:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Frontend (TypeScript/Svelte)"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Runs within Obsidian (Electron)."}),"\n",(0,c.jsx)(n.li,{children:"Manages UI, Settings, and File I/O for simple operations."}),"\n",(0,c.jsxs)(n.li,{children:["Uses Svelte for views (",(0,c.jsx)(n.code,{children:"src/views/"}),", ",(0,c.jsx)(n.code,{children:"src/components/"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:["Organized by modules: ",(0,c.jsx)(n.code,{children:"src/models"}),", ",(0,c.jsx)(n.code,{children:"src/services"}),", ",(0,c.jsx)(n.code,{children:"src/stores"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Backend (Python/Flask)"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Independent process managed by ",(0,c.jsx)(n.code,{children:"src/core/backend-process.ts"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"src/backend/journal_api.py"}),": The main entry point."]}),"\n",(0,c.jsx)(n.li,{children:"Handles complex Beancount parsing, BQL queries, and filtering."}),"\n",(0,c.jsx)(n.li,{children:"Exposes a local REST API (default port 5001)."}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Communication"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Frontend calls Backend via HTTP (",(0,c.jsx)(n.code,{children:"src/api/client.ts"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"BackendManager"})," handles process lifecycle (start, stop, health checks)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"-key-directories",children:"\ud83d\udcc2 Key Directories"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"src/"})}),": TypeScript source code."]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"main.ts"})}),": Plugin entry point."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"settings.ts"})}),": Settings tab definition."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"core/"})}),": Core logic (BackendProcess, Lifecycle)."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"backend/"})}),": Python source code."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"ui/"})}),": Svelte components and views."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"services/"})}),": Business logic services (JournalService, TransactionService)."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"types/"})}),": TypeScript definitions."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"docs-site/"})}),": Docusaurus documentation."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"-key-patterns",children:"\ud83e\udde9 Key Patterns"}),"\n",(0,c.jsx)(n.h3,{id:"backend-management",children:"Backend Management"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:'The backend is "Auto-starting".'}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"BackendProcess"})," spawns the python script."]}),"\n",(0,c.jsxs)(n.li,{children:["It polls ",(0,c.jsx)(n.code,{children:"/health"})," to check readiness."]}),"\n",(0,c.jsxs)(n.li,{children:["It creates a dedicated ",(0,c.jsx)(n.code,{children:".venv"})," if needed (logic in ",(0,c.jsx)(n.code,{children:"journal_api.py"})," or startup scripts)."]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"safe-file-writes",children:"Safe File Writes"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"NEVER"})," overwrite user data without a backup."]}),"\n",(0,c.jsxs)(n.li,{children:["Pattern:","\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Read file."}),"\n",(0,c.jsxs)(n.li,{children:["Write ",(0,c.jsx)(n.code,{children:"<file>.backup.<timestamp>"}),"."]}),"\n",(0,c.jsx)(n.li,{children:"Perform modification."}),"\n",(0,c.jsxs)(n.li,{children:["Write new content to ",(0,c.jsx)(n.code,{children:"<file>"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"bql-execution",children:"BQL Execution"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Code Blocks"}),": Handled by ",(0,c.jsx)(n.code,{children:"src/main.ts"})," registering a markdown code block processor."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Inline Queries"}),": Handled by regex parsing in ",(0,c.jsx)(n.code,{children:"src/main.ts"})," (or dedicated processor)."]}),"\n",(0,c.jsxs)(n.li,{children:["Both use ",(0,c.jsx)(n.code,{children:"BeanQueryService"})," to call ",(0,c.jsx)(n.code,{children:"bean-query"})," (either via CLI or Backend API)."]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"system-detection",children:"System Detection"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"src/utils/SystemDetector.ts"})," is the source of truth for paths."]}),"\n",(0,c.jsxs)(n.li,{children:["Handles ",(0,c.jsx)(n.code,{children:"wsl"})," path conversion (",(0,c.jsx)(n.code,{children:"/mnt/c/..."})," to/from ",(0,c.jsx)(n.code,{children:"C:\\..."}),")."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\ufe0f-development-tips",children:"\ud83d\udee0\ufe0f Development Tips"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Build"}),": ",(0,c.jsx)(n.code,{children:"npm run build"})," (uses esbuild)."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Hot Reload"}),": ",(0,c.jsx)(n.code,{children:"npm run dev"})," (watches changes)."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Logs"}),": Backend stdout/stderr is piped to Obsidian's Developer Console."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Styles"}),": ",(0,c.jsx)(n.code,{children:"styles.css"})," contains global styles; Svelte components use scoped styles."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"-common-tasks-for-agents",children:"\ud83e\udd16 Common Tasks for Agents"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Adding a new Visual"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Create Svelte component in ",(0,c.jsx)(n.code,{children:"src/ui/partials/"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Register in ",(0,c.jsx)(n.code,{children:"UnifiedDashboardView.svelte"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Fetch data via ",(0,c.jsx)(n.code,{children:"BeanQueryService"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Extending the API"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Add endpoint in ",(0,c.jsx)(n.code,{children:"src/backend/journal_api.py"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Add typed method in ",(0,c.jsx)(n.code,{children:"src/api/client.ts"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Updating Documentation"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Edit files in ",(0,c.jsx)(n.code,{children:"docs-site/docs/"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Follow the structure defined in ",(0,c.jsx)(n.code,{children:"sidebars.ts"}),"."]}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(6540);const c={},r=i.createContext(c);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);